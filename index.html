<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Global Market | ê¸€ë¡œë²Œ í•œì¸ì¥í„°</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/variable/pretendardvariable.min.css" />

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Pretendard Variable', 'sans-serif'] },
          colors: { 
            primary: '#2563EB', 
            primaryHover: '#1D4ED8',
            surface: '#F8FAFC' 
          },
          boxShadow: {
            'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
          }
        }
      }
    }
  </script>

  <style>
    body { background-color: #F8FAFC; color: #1E293B; -webkit-tap-highlight-color: transparent; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
    .loader { border: 3px solid #E2E8F0; border-top: 3px solid #2563EB; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    @media (max-width: 768px) {
      input, select, textarea { font-size: 16px !important; }
    }
    input, textarea, select { -webkit-appearance: none; appearance: none; }

    /* ëª¨ë˜ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
    .modern-input {
        width: 100%;
        background-color: #F1F5F9;
        border: 1px solid transparent;
        border-radius: 12px;
        padding: 14px 16px;
        font-size: 1rem;
        color: #1E293B;
        transition: all 0.2s;
        font-weight: 500;
    }
    .modern-input:focus {
        background-color: #FFFFFF;
        border-color: #2563EB;
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        outline: none;
    }
    .modern-input::placeholder { color: #94A3B8; font-weight: 400; }

    /* ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ìš© ì¸í’‹ */
    .input-field { 
        width: 100%; border-radius: 0.75rem; border: 1px solid #E2E8F0; background-color: #fff; 
        padding: 0.75rem 1rem; font-size: 0.95rem; color: #0F172A; transition: all 0.2s ease-in-out; 
    }
    .input-field:focus { border-color: #2563EB; outline: none; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }

    /* ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ */
    .modal-content { transform: scale(0.95); opacity: 0; transition: all 0.2s ease-out; }
    .modal-content.modal-active { transform: scale(1); opacity: 1; }
  </style>
</head>
<body class="antialiased min-h-screen flex flex-col font-sans pb-20 md:pb-0">

  <script>
    // [ì¤‘ìš”] ë°°í¬ëœ GAS ì›¹ ì•± URL ì…ë ¥
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycbw-6DyS3CmRxiw0Fbr-0s62myCwj8TsqExLoktQbQOvUEarFHXzpGBmoQQRHs7Phd5MMA/exec"; 
  </script>

  <nav class="sticky top-0 z-40 w-full bg-white/90 backdrop-blur-md border-b border-slate-200 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center gap-2 cursor-pointer group" onclick="showPage('list')">
          <div class="w-9 h-9 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-blue-500/30 transition-transform group-hover:scale-105">
            <i class="fa-solid fa-earth-americas text-lg"></i>
          </div>
          <span class="text-lg font-extrabold text-slate-800 tracking-tight">ê¸€ë¡œë²Œ í•œì¸ì¥í„°</span>
        </div>
        
        <div class="hidden md:flex items-center gap-3">
            <button onclick="shareApp()" class="flex items-center gap-2 bg-slate-100 hover:bg-slate-200 text-slate-700 px-4 py-2.5 rounded-xl font-bold text-sm transition-all active:scale-95">
                <i class="fa-solid fa-share-nodes"></i> ê³µìœ í•˜ê¸°
            </button>
            <button onclick="showPage('write')" class="flex items-center gap-2 bg-primary hover:bg-primaryHover text-white px-5 py-2.5 rounded-xl font-bold text-sm transition-all shadow-md hover:shadow-lg hover:-translate-y-0.5">
                <i class="fa-solid fa-pen"></i> ìƒí’ˆ ë“±ë¡
            </button>
        </div>

        <button onclick="shareApp()" class="md:hidden w-9 h-9 rounded-full bg-slate-100 active:bg-slate-200 flex items-center justify-center text-slate-600 transition-colors">
            <i class="fa-solid fa-share-nodes"></i>
        </button>
      </div>
    </div>
  </nav>

  <main class="flex-grow max-w-6xl mx-auto w-full px-4 sm:px-6 py-8">
    
    <div id="list-page">
      
      <div class="mb-8 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-3xl p-8 text-white shadow-xl relative overflow-hidden">
        <div class="relative z-10 max-w-2xl">
          <span class="inline-block py-1 px-3 rounded-full bg-white/20 backdrop-blur-md text-xs font-bold mb-3 border border-white/20">
            Global Korean Market
          </span>
          <h1 class="text-2xl md:text-3xl font-extrabold mb-3 leading-tight">
            íƒ€í–¥ì‚´ì´ì˜ ì‘ì€ ì‰¼í‘œ,<br/>ê¸€ë¡œë²Œ í•œì¸ì¥í„°
          </h1>
          <p class="text-blue-100 text-sm md:text-base font-medium leading-relaxed opacity-90">
            "ì´ê±° ëˆ„êµ¬í•œí…Œ íŒ”ì§€?" ê³ ë¯¼ë  ë•Œ,<br/>ìš°ë¦¬ ì´ì›ƒê³¼ ì‰½ê³  ì•ˆì „í•˜ê²Œ ê±°ë˜í•˜ì„¸ìš”.
          </p>
        </div>
        <div class="absolute -right-10 -bottom-20 w-64 h-64 bg-white/10 rounded-full blur-3xl"></div>
        <div class="absolute top-10 right-10 w-20 h-20 bg-blue-400/20 rounded-full blur-2xl"></div>
      </div>

      <div class="bg-white rounded-2xl shadow-soft border border-slate-100 p-4 mb-8">
        <div class="grid grid-cols-2 gap-3">
          
          <div class="relative">
             <select id="filter-country" class="input-field appearance-none cursor-pointer text-center bg-slate-50 hover:bg-slate-100 font-bold text-slate-600 transition-colors" onchange="filterItems()">
               <option value="">ğŸŒ ì „ì²´ êµ­ê°€</option>
             </select>
             </div>

          <div class="relative">
             <select id="filter-category" class="input-field appearance-none cursor-pointer text-center bg-slate-50 hover:bg-slate-100 font-bold text-slate-600 transition-colors" onchange="filterItems()">
               <option value="">ğŸ“‚ ì¹´í…Œê³ ë¦¬</option>
               <option value="ë””ì§€í„¸/ê°€ì „">ë””ì§€í„¸/ê°€ì „</option>
               <option value="ê°€êµ¬/ì¸í…Œë¦¬ì–´">ê°€êµ¬/ì¸í…Œë¦¬ì–´</option>
               <option value="ìƒí™œ/ê°€ê³µì‹í’ˆ">ìƒí™œ/ê°€ê³µì‹í’ˆ</option>
               <option value="ìœ ì•„ë™/ì¶œì‚°">ìœ ì•„ë™/ì¶œì‚°</option>
               <option value="ì˜ë¥˜/ì¡í™”">ì˜ë¥˜/ì¡í™”</option>
               <option value="ê¸°íƒ€">ê¸°íƒ€</option>
             </select>
             </div>

          <div class="col-span-2">
             <input type="text" id="filter-city" placeholder="ë„ì‹œ (ì˜ˆ: ëŸ°ë˜)" class="input-field text-center bg-slate-50 focus:bg-white transition-colors" onkeyup="filterItems()">
          </div>

          <div class="col-span-2 relative">
             <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
             <input type="text" id="filter-keyword" placeholder="ë¬´ì—‡ì„ ì°¾ê³  ê³„ì‹ ê°€ìš”?" class="input-field pl-10" onkeyup="filterItems()">
          </div>

        </div>
      </div>

      <div id="loading" class="flex flex-col items-center justify-center py-20">
        <div class="loader mb-4"></div>
        <p class="text-slate-500 font-medium animate-pulse">ë¬¼í’ˆì„ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</p>
      </div>

      <div id="item-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      
      <div id="no-data" class="hidden flex flex-col items-center justify-center py-20 text-slate-400">
        <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-4">
            <i class="fa-regular fa-folder-open text-3xl text-slate-300"></i>
        </div>
        <p class="text-lg font-bold text-slate-600">ë“±ë¡ëœ ë¬¼í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
    </div>

    <div id="write-page" class="hidden max-w-xl mx-auto">
      <div class="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-100 overflow-hidden">
        
        <div class="px-6 py-5 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0 z-30">
          <h2 class="text-xl font-extrabold text-slate-900">ë‚´ ë¬¼ê±´ íŒ”ê¸°</h2>
          <button onclick="showPage('list')" class="text-slate-400 hover:text-slate-600 p-2 -mr-2 transition-colors">
            <i class="fa-solid fa-xmark text-xl"></i>
          </button>
        </div>

        <form id="upload-form" onsubmit="handleUpload(event)" class="flex flex-col">
          
          <div class="p-6 pb-2">
            <div class="flex gap-4 overflow-x-auto no-scrollbar pb-2 items-center">
              <label class="flex-shrink-0 w-24 h-24 rounded-2xl border border-slate-200 bg-slate-50 flex flex-col items-center justify-center cursor-pointer active:scale-95 transition-transform text-slate-400 hover:text-blue-500 hover:border-blue-200 hover:bg-blue-50/50">
                <i class="fa-solid fa-camera text-2xl mb-1"></i>
                <span class="text-[11px] font-bold">ì‚¬ì§„ ì¶”ê°€</span>
                <input type="file" id="img-input" accept="image/*" multiple onchange="handleImagePreview(this)" class="hidden">
              </label>
              <div id="preview-container" class="flex gap-3"></div>
            </div>
            <p class="text-[11px] text-slate-400 font-medium mt-1 pl-1">â€» ëŒ€í‘œ ì´ë¯¸ì§€ëŠ” ì²« ë²ˆì§¸ ì‚¬ì§„ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.</p>
          </div>

          <div class="h-2 bg-slate-50 border-y border-slate-100"></div>

          <div class="p-6 space-y-6">
            
            <div class="space-y-4">
              <div>
                <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">ì œëª©</label>
                <input type="text" name="title" class="modern-input font-bold" placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required>
              </div>
              
              <div class="grid grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">ì¹´í…Œê³ ë¦¬</label>
                    <div class="relative">
                        <select name="category" class="modern-input appearance-none pr-8 truncate" required>
                            <option value="ë””ì§€í„¸/ê°€ì „">ë””ì§€í„¸/ê°€ì „</option>
                            <option value="ê°€êµ¬/ì¸í…Œë¦¬ì–´">ê°€êµ¬/ì¸í…Œë¦¬ì–´</option>
                            <option value="ìƒí™œ/ê°€ê³µì‹í’ˆ">ìƒí™œ/ê°€ê³µì‹í’ˆ</option>
                            <option value="ìœ ì•„ë™/ì¶œì‚°">ìœ ì•„ë™/ì¶œì‚°</option>
                            <option value="ì˜ë¥˜/ì¡í™”">ì˜ë¥˜/ì¡í™”</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                        <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 text-xs pointer-events-none"></i>
                    </div>
                 </div>
                 <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">ìƒíƒœ</label>
                    <div class="relative">
                        <select name="usage" class="modern-input appearance-none pr-8 truncate">
                            <option value="ë¯¸ê°œë´‰">ë¯¸ê°œë´‰</option>
                            <option value="1ê°œì›” ë¯¸ë§Œ">1ê°œì›” ë¯¸ë§Œ</option>
                            <option value="1~6ê°œì›”">1~6ê°œì›”</option>
                            <option value="6ê°œì›”~1ë…„">6ê°œì›”~1ë…„</option>
                            <option value="1ë…„ ì´ìƒ">1ë…„ ì´ìƒ</option>
                        </select>
                        <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 text-xs pointer-events-none"></i>
                    </div>
                 </div>
              </div>
            </div>

            <div>
               <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">íŒë§¤ ê°€ê²©</label>
               <div class="flex items-center gap-2">
                  <div class="relative w-24 shrink-0">
                    <input type="text" name="currency" id="currency-input" class="modern-input text-center bg-slate-100 text-slate-600 font-bold border-none" readonly placeholder="í†µí™”" tabindex="-1">
                  </div>
                  <input type="number" name="price" inputmode="decimal" class="modern-input font-bold text-blue-600 text-lg placeholder:text-base placeholder:font-normal placeholder:text-slate-300" placeholder="ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
               </div>
            </div>

            <div>
               <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">ìì„¸í•œ ì„¤ëª…</label>
               <textarea name="description" class="modern-input min-h-[140px] resize-none leading-relaxed" placeholder="ë¬¼í’ˆì— ëŒ€í•œ ìƒì„¸í•œ ì„¤ëª…ì„ ì ì–´ì£¼ì„¸ìš”. (êµ¬ì… ì‹œê¸°, ë¸Œëœë“œ, í ì§‘ ì—¬ë¶€ ë“±)" required></textarea>
            </div>
          </div>

          <div class="h-2 bg-slate-50 border-y border-slate-100"></div>

          <div class="p-6 space-y-6">
            
            <div class="grid grid-cols-5 gap-3">
                <div class="col-span-2">
                    <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">êµ­ê°€</label>
                    <div class="relative">
                        <select name="country" id="input-country" class="modern-input appearance-none pr-8 truncate" required onchange="handleCountryChange(this.value)">
                          <option value="">ì„ íƒ</option>
                        </select>
                        <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 text-xs pointer-events-none"></i>
                    </div>
                    <input type="text" id="input-country-custom" class="modern-input mt-2 hidden" placeholder="êµ­ê°€ëª… ì…ë ¥">
                </div>
                <div class="col-span-3">
                    <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">ë„ì‹œ</label>
                    <input type="text" name="city" class="modern-input" placeholder="ì˜ˆ: ëŸ°ë˜, ë‰´ìš•" required>
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">ê±°ë˜ ë°©ë²•</label>
                <div class="grid grid-cols-2 gap-2 bg-slate-100 p-1 rounded-xl">
                    <label class="cursor-pointer">
                        <input type="radio" name="delivery" value="ì§ê±°ë˜" class="peer hidden" checked>
                        <div class="text-center py-3 rounded-lg text-sm font-bold text-slate-500 transition-all peer-checked:bg-white peer-checked:text-blue-600 peer-checked:shadow-sm">ì§ê±°ë˜</div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="delivery" value="íƒë°°" class="peer hidden">
                        <div class="text-center py-3 rounded-lg text-sm font-bold text-slate-500 transition-all peer-checked:bg-white peer-checked:text-blue-600 peer-checked:shadow-sm">íƒë°°</div>
                    </label>
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">íŒë§¤ ì¢…ë£Œì¼</label>
                <input type="date" name="endDate" class="modern-input text-slate-600" required>
            </div>

          </div>

          <div class="h-2 bg-slate-50 border-y border-slate-100"></div>

          <div class="p-6 space-y-5">
            
            <div class="space-y-4">
                <div>
                   <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">ì „í™”ë²ˆí˜¸</label>
                   <input type="text" name="phone" id="phone-input" inputmode="tel" class="modern-input" placeholder="ë²ˆí˜¸ ì…ë ¥">
                </div>
                <div>
                   <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">ì¹´í†¡ ID</label>
                   <input type="text" name="kakaoId" class="modern-input" placeholder="ID ì…ë ¥">
                </div>
            </div>
            
            <div>
                <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1">ì˜¤í”ˆì±„íŒ… ì£¼ì†Œ</label>
                <input type="text" name="openChat" class="modern-input text-blue-600 underline-offset-2 placeholder:no-underline placeholder:text-slate-300" placeholder="https://open.kakao.com/...">
            </div>

            <div class="pt-2">
                <div class="relative">
                    <input type="password" name="password" class="modern-input border-yellow-200 bg-yellow-50 focus:bg-white focus:border-yellow-400 text-sm pl-10" placeholder="ê´€ë¦¬ ë¹„ë°€ë²ˆí˜¸ (ìˆ˜ì •/ì‚­ì œìš©)" required>
                    <i class="fa-solid fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-yellow-400 text-sm"></i>
                </div>
            </div>

          </div>

          <div class="p-4 border-t border-slate-100 bg-white sticky bottom-0 z-30">
            <button type="submit" id="submit-btn" class="w-full py-4 rounded-xl bg-primary text-white text-lg font-bold shadow-lg shadow-blue-500/30 hover:bg-primaryHover active:scale-[0.98] transition-all">
                ì‘ì„± ì™„ë£Œ
            </button>
          </div>

        </form>
      </div>
    </div>
  </main>

  <div id="detail-modal" class="fixed inset-0 z-50 hidden flex items-start justify-center px-4 pt-12 pb-4">
    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity opacity-0 modal-bg" onclick="closeModal('detail-modal')"></div>
    <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-hidden flex flex-col transform scale-95 opacity-0 transition-all modal-content">
      <button onclick="closeModal('detail-modal')" class="absolute top-4 right-4 z-20 w-8 h-8 flex items-center justify-center rounded-full bg-black/30 hover:bg-black/50 text-white backdrop-blur-md transition-all"><i class="fa-solid fa-xmark"></i></button>
      <div id="modal-images" class="w-full h-72 bg-slate-100 flex overflow-x-auto snap-x snap-mandatory no-scrollbar shrink-0"></div>
      <div class="p-6 overflow-y-auto">
        <div class="flex justify-between items-start mb-3">
            <div class="flex flex-wrap gap-2 text-xs font-bold uppercase tracking-wide">
                <span id="modal-country-city" class="bg-blue-50 text-blue-700 px-2.5 py-1 rounded-md border border-blue-100"></span>
                <span id="modal-category" class="bg-slate-100 text-slate-600 px-2.5 py-1 rounded-md border border-slate-200"></span>
            </div>
            <span id="modal-time-left" class="text-xs font-bold text-rose-500 bg-rose-50 px-2 py-1 rounded-md border border-rose-100 whitespace-nowrap"></span>
        </div>
        <h3 id="modal-title" class="text-xl md:text-2xl font-bold text-slate-900 mb-2 leading-tight break-words"></h3>
        <p id="modal-price" class="text-xl font-extrabold text-blue-600 mb-5"></p>
        <div class="grid grid-cols-2 gap-3 mb-5">
            <div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center">
                <div class="text-xs text-slate-400 mb-1">ìƒíƒœ</div>
                <div id="modal-usage" class="text-sm font-bold text-slate-700"></div>
            </div>
            <div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center">
                <div class="text-xs text-slate-400 mb-1">ê±°ë˜</div>
                <div id="modal-delivery" class="text-sm font-bold text-slate-700"></div>
            </div>
        </div>
        <div class="prose prose-sm prose-slate max-w-none mb-6 p-4 bg-slate-50/50 rounded-xl border border-slate-100">
            <p id="modal-desc" class="whitespace-pre-wrap text-slate-600 leading-relaxed"></p>
        </div>
        <div class="space-y-2 mb-6">
            <button id="btn-phone" class="hidden w-full bg-emerald-500 hover:bg-emerald-600 text-white py-3.5 rounded-xl font-bold flex items-center justify-center gap-2 transition shadow-md shadow-emerald-100"><i class="fa-solid fa-phone"></i> ì „í™” ê±¸ê¸°</button>
            <button id="btn-kakao-copy" class="hidden w-full bg-[#FEE500] hover:bg-[#FDD835] text-slate-900 py-3.5 rounded-xl font-bold flex items-center justify-center gap-2 transition shadow-md shadow-yellow-100"><i class="fa-solid fa-comment"></i> ì¹´í†¡ ID ë³µì‚¬</button>
            <button id="btn-open-chat" class="hidden w-full bg-slate-800 hover:bg-slate-900 text-white py-3.5 rounded-xl font-bold flex items-center justify-center gap-2 transition shadow-md"><i class="fa-solid fa-arrow-up-right-from-square"></i> ì˜¤í”ˆì±„íŒ…</button>
        </div>
        
        <div class="relative z-10 border-t border-slate-100 pt-4 flex justify-between items-center text-xs text-slate-400">
            <span id="modal-end-date-text"></span>
            <button id="btn-delete-trigger" onclick="openDeleteModal()" class="flex items-center gap-1 hover:text-red-500 transition-colors p-2 -mr-2 cursor-pointer touch-action-manipulation">
                <i class="fa-regular fa-trash-can"></i> <span class="font-bold">ì‚­ì œ</span>
            </button>
        </div>
      </div>
    </div>
  </div>

  <div id="password-modal" class="fixed inset-0 z-[60] hidden flex items-start justify-center px-4 pt-24">
    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeModal('password-modal')"></div>
    <div class="relative bg-white rounded-2xl shadow-xl p-6 w-full max-w-xs transform scale-100 transition-all border border-slate-100 text-center modal-content">
        <h3 class="text-lg font-bold text-slate-900 mb-2">ì‚­ì œ í™•ì¸</h3>
        <p class="text-xs text-slate-500 mb-4">ë“±ë¡ ì‹œ ì„¤ì •í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
        <input type="password" id="delete-password" class="input-field mb-4 text-center tracking-widest font-bold bg-slate-50" placeholder="â—â—â—â—">
        <div class="flex gap-2">
            <button onclick="closeModal('password-modal')" class="flex-1 py-2.5 bg-white border border-slate-200 hover:bg-slate-50 text-slate-600 rounded-lg text-sm font-bold transition">ì·¨ì†Œ</button>
            <button onclick="submitDelete()" class="flex-1 py-2.5 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-bold shadow-lg shadow-red-200 transition">ì‚­ì œ</button>
        </div>
    </div>
  </div>

  <div id="custom-alert-modal" class="fixed inset-0 z-[70] hidden flex items-start justify-center px-4 pt-24">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
    <div class="relative bg-white rounded-xl p-6 max-w-sm w-full shadow-2xl text-center">
        <h3 class="text-lg font-bold text-slate-900 mb-2">ì•Œë¦¼</h3>
        <p id="custom-alert-message" class="text-sm text-slate-500 mb-5"></p>
        <button onclick="confirmCustomAlert()" class="w-full bg-blue-600 text-white py-2.5 rounded-lg font-bold hover:bg-blue-700 transition">í™•ì¸</button>
    </div>
  </div>

  <div id="loading-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
    <div class="relative bg-white rounded-2xl p-8 flex flex-col items-center shadow-2xl animate-in zoom-in duration-300 w-64 border border-slate-100">
        <div class="w-12 h-12 border-4 border-blue-100 border-t-primary rounded-full animate-spin mb-4"></div>
        <h3 class="text-lg font-bold text-slate-800 mb-1">ì—…ë¡œë“œ ì¤‘...</h3>
        <p class="text-xs text-slate-500 font-medium">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</p>
    </div>
  </div>

  <div id="floating-btn" class="md:hidden fixed bottom-6 right-6 z-40">
      <button onclick="showPage('write')" class="w-14 h-14 bg-blue-600 text-white rounded-full shadow-xl shadow-blue-500/40 flex items-center justify-center text-2xl transition-transform active:scale-90 hover:bg-blue-700">
        <i class="fa-solid fa-plus"></i>
      </button>
  </div>

  <script>
    const COUNTRY_DATA = {
        'í•œêµ­': { code: '+82', currency: 'â‚©' }, 'ë¯¸êµ­': { code: '+1', currency: '$' }, 'ìºë‚˜ë‹¤': { code: '+1', currency: 'C$' }, 'ì¼ë³¸': { code: '+81', currency: 'Â¥' }, 'ì¤‘êµ­': { code: '+86', currency: 'Â¥' }, 'í˜¸ì£¼': { code: '+61', currency: 'A$' }, 'ë‰´ì§ˆëœë“œ': { code: '+64', currency: 'NZ$' }, 'ì˜êµ­': { code: '+44', currency: 'Â£' }, 'ë…ì¼': { code: '+49', currency: 'â‚¬' }, 'í”„ë‘ìŠ¤': { code: '+33', currency: 'â‚¬' }, 'ë² íŠ¸ë‚¨': { code: '+84', currency: 'â‚«' }, 'í•„ë¦¬í•€': { code: '+63', currency: 'â‚±' }, 'íƒœêµ­': { code: '+66', currency: 'à¸¿' }, 'ì‹±ê°€í¬ë¥´': { code: '+65', currency: 'S$' }, 'ë§ë ˆì´ì‹œì•„': { code: '+60', currency: 'RM' }, 'ì¸ë„ë„¤ì‹œì•„': { code: '+62', currency: 'Rp' }, 'ë¸Œë¼ì§ˆ': { code: '+55', currency: 'R$' }, 'ëŸ¬ì‹œì•„': { code: '+7', currency: 'â‚½' }
    };

    let allItems = [];
    let currentDetailId = null;
    let selectedImages = [];
    let customAlertCallback = null;

    // --- Init ---
    window.onload = function() {
        initCountryOptions();
        fetchItems();
        window.onpopstate = () => {
            document.querySelectorAll('.fixed.z-50, .fixed.z-[60]').forEach(el => {
                if(!el.classList.contains('hidden')) {
                    el.classList.add('hidden');
                    const content = el.querySelector('.modal-content');
                    if(content) content.classList.remove('modal-active');
                }
            });
        };
    };

    function initCountryOptions() {
        const selectFilter = document.getElementById('filter-country');
        const selectInput = document.getElementById('input-country');
        
        Object.keys(COUNTRY_DATA).sort().forEach(country => {
            selectFilter.appendChild(new Option(country, country));
            selectInput.appendChild(new Option(country, country));
        });
        
        const directOpt = document.createElement('option');
        directOpt.value = 'direct';
        directOpt.innerText = 'âœï¸ ì§ì ‘ ì…ë ¥';
        selectInput.appendChild(directOpt);
    }

    function handleCountryChange(val) {
        const customInput = document.getElementById('input-country-custom');
        const currencyInput = document.getElementById('currency-input');
        const phoneInput = document.getElementById('phone-input');

        if (val === 'direct') {
            customInput.classList.remove('hidden');
            customInput.required = true;
            currencyInput.value = ''; 
            phoneInput.value = '';
        } else {
            customInput.classList.add('hidden');
            customInput.required = false;
            const data = COUNTRY_DATA[val];
            if (data) {
                currencyInput.value = data.currency;
                phoneInput.value = data.code + ' ';
            } else {
                currencyInput.value = '';
                phoneInput.value = '';
            }
        }
    }

    // --- ê³µìœ í•˜ê¸° ê¸°ëŠ¥ ---
    function shareApp() {
        const shareData = {
            title: 'Global Market',
            text: 'í•´ì™¸ ìƒí™œì˜ ë“ ë“ í•œ ì§€ì›êµ°, ê¸€ë¡œë²Œ í•œì¸ì¥í„°ì—ì„œ ìš°ë¦¬ ì´ì›ƒê³¼ ê±°ë˜í•˜ì„¸ìš”!',
            url: window.location.href
        };

        if (navigator.share) {
            navigator.share(shareData).catch((err) => console.log('ê³µìœ  ì·¨ì†Œë¨', err));
        } else {
            navigator.clipboard.writeText(window.location.href).then(() => {
                showCustomAlert('í˜ì´ì§€ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }).catch(err => {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                showCustomAlert('ì£¼ì†Œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }
    }

    // --- Core Functions ---
    async function apiFetch(method, body = null) {
        if (GAS_API_URL.includes("...")) { showCustomAlert("API URLì„ ì„¤ì •í•´ì£¼ì„¸ìš”."); return null; }
        const options = { method: method };
        if (method === 'POST' && body) {
            options.body = JSON.stringify(body);
            options.headers = { "Content-Type": "text/plain;charset=utf-8" };
        }
        try {
            const response = await fetch(GAS_API_URL, options);
            return await response.json();
        } catch (error) {
            console.error(error);
            showCustomAlert("ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            return null;
        }
    }

    function showCustomAlert(message, callback = null) {
        document.getElementById('custom-alert-message').textContent = message;
        document.getElementById('custom-alert-modal').classList.remove('hidden');
        customAlertCallback = callback;
    }

    function confirmCustomAlert() {
        document.getElementById('custom-alert-modal').classList.add('hidden');
        if (customAlertCallback) { customAlertCallback(); customAlertCallback = null; }
    }

    // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ ì¬ì‚¬ìš©
    function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
    function closeModal(id) {
        const modal = document.getElementById(id);
        if(id === 'detail-modal' || id === 'password-modal') {
            const bg = modal.querySelector('.modal-bg') || modal.querySelector('.absolute');
            const content = modal.querySelector('.modal-content') || modal.querySelector('.relative');
            
            if(bg) bg.classList.add('opacity-0');
            if(content) content.classList.remove('modal-active');
            
            setTimeout(() => modal.classList.add('hidden'), 200);
            
            if(history.state && history.state.modal) history.back();
        } else {
            modal.classList.add('hidden');
        }
    }

    function showPage(pageId) {
        document.getElementById('list-page').classList.toggle('hidden', pageId !== 'list');
        document.getElementById('write-page').classList.toggle('hidden', pageId !== 'write');
        
        // í”Œë¡œíŒ… ë²„íŠ¼ ì œì–´ (ê¸€ì“°ê¸° í˜ì´ì§€ì—ì„œëŠ” ìˆ¨ê¹€)
        const fab = document.getElementById('floating-btn');
        if(fab) fab.classList.toggle('hidden', pageId === 'write');

        if (pageId === 'list') fetchItems();
        window.scrollTo(0, 0);
    }

    // --- List Logic ---
    async function fetchItems() {
        document.getElementById('loading').classList.remove('hidden');
        document.getElementById('item-grid').innerHTML = '';
        document.getElementById('no-data').classList.add('hidden');

        const data = await apiFetch('GET');
        document.getElementById('loading').classList.add('hidden');
        
        if (data) {
            allItems = data;
            renderItems(allItems);
        }
    }

    function renderItems(items) {
        const grid = document.getElementById('item-grid');
        grid.innerHTML = '';
        if (items.length === 0) { document.getElementById('no-data').classList.remove('hidden'); return; }
        document.getElementById('no-data').classList.add('hidden');

        items.forEach(item => {
            let images = [];
            try { 
                if (typeof item.images === 'string') {
                    images = JSON.parse(item.images); 
                } else if (Array.isArray(item.images)) {
                    images = item.images;
                }
            } catch(e) {}
            
            const thumb = (Array.isArray(images) && images.length > 0) ? images[0] : 'https://via.placeholder.com/400x300?text=No+Image';
            
            const endD = new Date(item.endDate);
            const today = new Date();
            today.setHours(0,0,0,0); endD.setHours(0,0,0,0);
            const diffDays = Math.ceil((endD - today) / (1000 * 60 * 60 * 24));
            let dDayBadge = '';
            if(diffDays < 0) dDayBadge = '<span class="bg-gray-100 text-gray-500 text-[10px] font-bold px-1.5 py-0.5 rounded">ë§ˆê°</span>';
            else if(diffDays === 0) dDayBadge = '<span class="bg-red-100 text-red-600 text-[10px] font-bold px-1.5 py-0.5 rounded animate-pulse">ì˜¤ëŠ˜ë§ˆê°</span>';
            else dDayBadge = `<span class="bg-blue-50 text-blue-600 text-[10px] font-bold px-1.5 py-0.5 rounded">D-${diffDays}</span>`;

            // ê°€ê²© ì½¤ë§ˆ ì²˜ë¦¬
            const rawPrice = String(item.price).replace(/[^0-9.-]+/g,"");
            const priceNum = Number(rawPrice);
            const displayPrice = isNaN(priceNum) ? item.price : priceNum.toLocaleString();

            const card = document.createElement('div');
            card.className = "bg-white rounded-2xl shadow-soft hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer overflow-hidden border border-slate-100 flex flex-col h-full group";
            card.onclick = () => openDetail(item);
            
            card.innerHTML = `
                <div class="h-48 bg-slate-100 relative overflow-hidden">
                    <img src="${thumb}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="absolute top-3 left-3">
                        <span class="text-[10px] font-bold text-slate-800 bg-white/95 backdrop-blur-sm px-2 py-1 rounded-md shadow-sm">${item.country || 'êµ­ê°€'}</span>
                    </div>
                </div>
                <div class="p-4 flex-1 flex flex-col">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full">${item.category || 'ê¸°íƒ€'}</span>
                        ${dDayBadge}
                    </div>
                    <h3 class="font-bold text-[17px] text-slate-800 leading-snug mb-1 line-clamp-1 group-hover:text-blue-600 transition-colors">${item.title}</h3>
                    <p class="text-xs text-slate-400 mb-3 flex items-center gap-1"><i class="fa-solid fa-location-dot"></i> ${item.city || ''}</p>
                    <div class="mt-auto border-t border-slate-50 pt-3 flex justify-between items-center">
                        <span class="font-extrabold text-lg text-slate-900">${item.currency || ''} ${displayPrice}</span>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function filterItems() {
        const country = document.getElementById('filter-country').value;
        const city = document.getElementById('filter-city').value.toLowerCase();
        const category = document.getElementById('filter-category').value;
        const keyword = document.getElementById('filter-keyword').value.toLowerCase();

        const filtered = allItems.filter(item => {
            return (country === "" || item.country === country) &&
                   (city === "" || item.city.toLowerCase().includes(city)) &&
                   (category === "" || item.category === category) &&
                   (keyword === "" || item.title.toLowerCase().includes(keyword) || item.description.toLowerCase().includes(keyword));
        });
        renderItems(filtered);
    }

    function openDetail(item) {
        try {
            currentDetailId = item.id;
            const deleteBtn = document.getElementById('btn-delete-trigger');
            
            if (!currentDetailId && currentDetailId !== 0) {
                deleteBtn.classList.add('hidden');
            } else {
                deleteBtn.classList.remove('hidden');
            }

            const modal = document.getElementById('detail-modal');
            const bg = modal.querySelector('.modal-bg');
            const content = modal.querySelector('.modal-content');

            history.pushState({modal: true}, null, "");

            // í…ìŠ¤íŠ¸ ë°”ì¸ë”©
            document.getElementById('modal-title').textContent = item.title || 'ì œëª© ì—†ìŒ';
            document.getElementById('modal-country-city').textContent = `${item.country || ''} Â· ${item.city || ''}`;
            document.getElementById('modal-category').textContent = item.category || 'ê¸°íƒ€';

            // ê°€ê²© ì²˜ë¦¬
            const rawPrice = String(item.price).replace(/[^0-9.-]+/g,""); 
            const priceNum = Number(rawPrice);
            const displayPrice = isNaN(priceNum) ? item.price : priceNum.toLocaleString();
            document.getElementById('modal-price').textContent = `${item.currency || ''} ${displayPrice}`;

            document.getElementById('modal-usage').textContent = item.usage || '-';
            document.getElementById('modal-delivery').textContent = item.delivery || '-';
            document.getElementById('modal-desc').textContent = item.description || '';
            
            // D-Day ê³„ì‚°
            const endD = new Date(item.endDate);
            const today = new Date();
            today.setHours(0,0,0,0); endD.setHours(0,0,0,0);
            const diffDays = Math.ceil((endD - today) / (1000 * 60 * 60 * 24));
            
            const timeBadge = document.getElementById('modal-time-left');
            let dDayText = '';
            let dDayClass = '';

            if (isNaN(diffDays)) {
                 timeBadge.classList.add('hidden');
            } else {
                timeBadge.classList.remove('hidden');
                if(diffDays < 0) {
                    dDayText = 'ë§ˆê°';
                    dDayClass = "text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded-md border border-slate-200 whitespace-nowrap";
                } else if(diffDays === 0) {
                    dDayText = 'ì˜¤ëŠ˜ë§ˆê°';
                    dDayClass = "text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded-md border border-red-100 whitespace-nowrap animate-pulse";
                } else {
                    dDayText = `D-${diffDays}`;
                    dDayClass = "text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded-md border border-blue-100 whitespace-nowrap";
                }
                timeBadge.textContent = dDayText;
                timeBadge.className = dDayClass;
            }

            // í•˜ë‹¨ ë§ˆê°ì¼ í…ìŠ¤íŠ¸ ì²˜ë¦¬
            let dateStr = "";
            if (item.endDate) {
                try {
                    dateStr = String(item.endDate).split('T')[0];
                } catch (e) {
                    dateStr = item.endDate;
                }
            }
            document.getElementById('modal-end-date-text').innerHTML = `<i class="fa-regular fa-clock mr-1"></i> ë§ˆê°ì¼: ${dateStr}`;

            // ì´ë¯¸ì§€ ì²˜ë¦¬
            const imgContainer = document.getElementById('modal-images');
            imgContainer.innerHTML = '';
            let images = [];
            try { 
                if (typeof item.images === 'string') {
                    images = JSON.parse(item.images);
                } else if (Array.isArray(item.images)) {
                    images = item.images;
                }
            } catch(e) { images = []; }
            
            if (!Array.isArray(images)) images = []; 

            if(images.length === 0) {
                imgContainer.innerHTML = '<div class="w-full h-full flex flex-col items-center justify-center text-slate-300 min-h-[18rem]"><i class="fa-regular fa-image text-3xl mb-2"></i><span class="text-xs">ì´ë¯¸ì§€ ì—†ìŒ</span></div>';
            } else {
                images.forEach(src => {
                    const img = document.createElement('img');
                    img.src = src;
                    img.className = "snap-center w-full h-full object-contain bg-black shrink-0";
                    imgContainer.appendChild(img);
                });
            }

            // [ìˆ˜ì •ë¨] ê°•ë ¥í•œ í´ë¦½ë³´ë“œ ë³µì‚¬ í•¨ìˆ˜ (í˜¸í™˜ì„± ê°œì„ )
            const copyToClipboard = (text) => {
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(text).then(() => {
                        showCustomAlert('ì¹´í†¡ IDê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    }).catch(err => {
                        console.error('Async: Could not copy text: ', err);
                        fallbackCopy(text);
                    });
                } else {
                    fallbackCopy(text);
                }
            };

            const fallbackCopy = (text) => {
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.top = "0";
                    textArea.style.left = "0";
                    textArea.style.position = "fixed";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    if (successful) {
                        showCustomAlert('ì¹´í†¡ IDê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        showCustomAlert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (err) {
                    console.error('Fallback: Could not copy text: ', err);
                    showCustomAlert('ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            };

            // ë²„íŠ¼ í‘œì‹œ ì œì–´
            const setupBtn = (id, val, handler) => {
                const el = document.getElementById(id);
                if(val && String(val).trim() !== '') { 
                    el.classList.remove('hidden'); 
                    el.onclick = handler; 
                } else { 
                    el.classList.add('hidden'); 
                }
            };
            
            setupBtn('btn-phone', item.phone, () => window.location.href = `tel:${item.phone}`);
            
            // [ìˆ˜ì •ë¨] ì¹´í†¡ ID ë³µì‚¬ ë²„íŠ¼ ì—°ê²°
            setupBtn('btn-kakao-copy', item.kakaoId, () => {
                 copyToClipboard(item.kakaoId);
            });
            
            setupBtn('btn-open-chat', (item.openChat && item.openChat.startsWith('http')), () => window.open(item.openChat, '_blank'));

            modal.classList.remove('hidden');
            setTimeout(() => {
                if(bg) bg.classList.remove('opacity-0');
                if(content) content.classList.add('modal-active');
            }, 10);
        } catch (err) {
            console.error("Detail Error:", err);
            showCustomAlert("ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    function openDeleteModal() {
        const modal = document.getElementById('password-modal');
        const content = modal.querySelector('.modal-content');

        modal.classList.remove('hidden');
        
        setTimeout(() => {
            if(content) content.classList.add('modal-active');
        }, 10);

        document.getElementById('delete-password').value = '';
        document.getElementById('delete-password').focus();
    }

    async function submitDelete() {
        if (!currentDetailId && currentDetailId !== 0) {
            showCustomAlert("ì˜¤ë¥˜: ì‚­ì œí•  í•­ëª©ì˜ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        const pw = document.getElementById('delete-password').value;
        if(!pw) return showCustomAlert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        
        const btn = document.querySelector('#password-modal button:last-child');
        const originalText = btn.innerText;
        btn.innerText = 'ì‚­ì œ ì¤‘...';
        btn.disabled = true;

        const res = await apiFetch('POST', { action: 'delete', id: currentDetailId, password: pw });
        
        btn.innerText = originalText;
        btn.disabled = false;

        if(res && res.success) {
            closeModal('password-modal');
            closeModal('detail-modal');
            showCustomAlert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', fetchItems);
        } else {
            showCustomAlert(res ? res.message : 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦¬ê±°ë‚˜ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // --- Upload Logic ---
    function handleImagePreview(input) {
        const container = document.getElementById('preview-container');
        container.innerHTML = '';
        selectedImages = [];
        Array.from(input.files).slice(0, 3).forEach(file => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const maxW = 800; 
                    const scale = maxW / img.width;
                    canvas.width = maxW;
                    canvas.height = img.height * scale;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                    selectedImages.push(dataUrl);
                    
                    const thumb = document.createElement('img');
                    thumb.src = dataUrl;
                    thumb.className = "h-24 w-24 object-cover rounded-xl border border-slate-200 shrink-0";
                    container.appendChild(thumb);
                }
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    // [ìˆ˜ì •ë¨] ì—…ë¡œë“œ í•¨ìˆ˜ (ë¡œë”© ëª¨ë‹¬ ì¶”ê°€)
    async function handleUpload(e) {
        e.preventDefault();
        const btn = document.getElementById('submit-btn');
        const originalText = btn.innerText;
        
        btn.disabled = true; 
        
        // ë¡œë”© ëª¨ë‹¬ ì—´ê¸°
        openModal('loading-modal');

        const form = document.getElementById('upload-form');
        
        let countryVal = form.country.value;
        if (countryVal === 'direct') {
            countryVal = document.getElementById('input-country-custom').value;
            if(!countryVal) {
                showCustomAlert("êµ­ê°€ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                btn.disabled = false;
                closeModal('loading-modal'); // ëª¨ë‹¬ ë‹«ê¸°
                return;
            }
        }

        const formData = {
            action: 'create',
            country: countryVal,
            city: form.city.value,
            category: form.category.value,
            title: form.title.value,
            description: form.description.value,
            usage: form.usage.value,
            delivery: form.delivery.value,
            currency: form.currency.value,
            price: form.price.value,
            endDate: form.endDate.value,
            phone: form.phone.value,
            kakaoId: form.kakaoId.value,
            openChat: form.openChat.value,
            password: form.password.value,
            images: selectedImages
        };

        try {
            const res = await apiFetch('POST', formData);
            
            // ë¡œë”© ëª¨ë‹¬ ë‹«ê¸°
            closeModal('loading-modal');
            btn.disabled = false;

            if(res && res.success) {
                showCustomAlert("ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!", () => {
                    form.reset();
                    document.getElementById('preview-container').innerHTML = '';
                    selectedImages = [];
                    document.getElementById('input-country-custom').classList.add('hidden');
                    showPage('list');
                });
            } else {
                showCustomAlert("ë“±ë¡ ì‹¤íŒ¨: " + (res ? res.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        } catch(err) {
            closeModal('loading-modal');
            btn.disabled = false;
            showCustomAlert("ì˜¤ë¥˜ ë°œìƒ: " + err);
        }
    }
  </script>
</body>
</html>
